---
import Layout from '../../layouts/Layout.astro';
import Footer from '../../components/Footer.astro';

export function getStaticPaths() {
    const allPosts = Object.values(import.meta.glob('../../data/articles/*.md', { eager: true }));
    return allPosts.map((post) => {
        const { file, frontmatter, Content } = post;
        const articleSlug = frontmatter.slug || file.split('/').pop().replace('.md', '');

        return {
            params: { article: articleSlug },
            props: { frontmatter, Content },
        };
    });
}

const rawPosts = Object.values(import.meta.glob('../../data/articles/*.md', { eager: true }));
const allPosts = rawPosts.map((post) => {
    const { file, frontmatter } = post;
    const articleSlug = frontmatter.slug || file.split('/').pop().replace('.md', '');
    return {
        title: frontmatter.title,
        description: frontmatter.description,
        link: `/articles/${articleSlug}`,
    }
});

const { frontmatter, Content } = Astro.props;

const otherPosts = allPosts.filter(post => post.link !== Astro.url.pathname);
---
<Layout title={frontmatter.title} description={frontmatter.description}>
    <main>
        <div
            class="relative w-full bg-cover bg-center pt-48 pb-24"
            style={{ backgroundImage: `url(${frontmatter.thumbnail})` }}
        >
            <div class="relative container mx-auto px-4 flex flex-col text-white items-start justify-center gap-2 text-left">
                <h1 class="text-4xl md:text-5xl !text-white font-extrabold leading-tight" style="text-shadow: 0 2px 4px rgba(0,0,0,0.5);">{frontmatter.title}</h1>
                <div class="bg-primary/80 text-white px-4 py-2 my-4 text-sm rounded-full">
                    Oleh: {frontmatter.author} &middot; {new Date(frontmatter.date).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' })}
                </div>
            </div>
        </div>

        <div class="container mx-auto flex md:flex-row flex-col gap-8 md:gap-12 p-4 md:p-8 lg:p-12">
            
            <article class="w-full md:w-3/4">
                <div class="prose prose-lg max-w-none prose-h2:text-primary prose-a:text-primary prose-img:rounded-xl">
                    <Content/>
                </div>
            </article>

            <aside class="w-full md:w-1/4 md:sticky md:top-28 h-fit bg-white p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl mb-4 border-b-2 border-primary pb-2">Artikel Lainnya</h2>
                <ul class="flex flex-col gap-4">
                    {otherPosts.slice(0, 5).map((post) => (
                        <li>
                            <a href={post.link} class="block p-4 rounded-lg hover:bg-gray-100 transition-colors">
                                <h3 class="font-semibold !text-gray-800">{post.title}</h3>
                                <p class="text-sm text-gray-500 line-clamp-2">{post.description}</p>
                            </a>
                        </li>
                    ))}
                </ul>
            </aside>
        </div>
    </main>
    <Footer/>
</Layout>
